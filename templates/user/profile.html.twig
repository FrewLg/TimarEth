{# {% extends 'widebase.html.twig' %} #}
{% extends 'base.html.twig' %}

{% block title %}Profile
{% endblock %}


{% block styles %}
	<style>
		.progress {
			height: 25px;
			margin-top: 10px;
			display: none; /* Initially hidden */
		}
		.progress-bar {
			transition: width 0.6s ease; /* Smooth transition - adjust duration as needed */
		}

		.flash-message {
			padding: 10px;
			margin-bottom: 10px;
			border-radius: 5px;
			position: fixed;
			top: 20px;
			left: 50%;
			transform: translateX(-50%);
			z-index: 1000;
		}
		.flash-message.success {
			background-color: #d4edda;
			color: #155724;
		}

		.flash-message.error {
			background-color: #f8d7da;
			color: #721c24;
		}
	</style>

{% endblock %}

{% macro displayWorkExperiences(experience) %}

	<div class="form-group row">
		<div class="col-2">

			{{form_label(experience.orgName)}}
			{{form_widget(experience.orgName)}}

		</div>
		<div class="col-2">

			{{form_label(experience.jobPosition)}}
			{{form_widget(experience.jobPosition)}}

		</div>
		<div class="col-2">

			{{form_label(experience.dateStarted)}}
			{{form_widget(experience.dateStarted)}}

		</div>
		<div class="col-2">

			{{form_label(experience.dateLeft)}}
			{{form_widget(experience.dateLeft)}}

		</div>
		<div class="col-3">

			{{form_label(experience.responsibilities)}}
			{{form_widget(experience.responsibilities)}}

		</div>

		<div class="col-1">

			<button type="button" class="btn   btn-danger close  remove-collection-widget btn-lg mt-8">
				<span aria-hidden="true" class="btn   btn-sm  btn-danger">Ã—</span>
			</button>
		</div>

		<hr>
		<div class="separator separator-dashed mt-2 mb-2"></div>

	</div>


{% endmacro %}

{% block body %}


	<div class="flash-message"></div>


	<div class="contasiner">
		<div class="card card-custom gutter-b shadow-lg p-3 mb-5  bg-body rounded">
			<div class="card-body">
				<div
					class="d-flex">
					<!--begin::Pic-->
					<div class="flex-shrink-0 mr-7">
						<div class="symbol symbol-50 symbol-lg-120">
							{{ form_start(profileform ) }}

							<div class="image-input image-input-outline" id="kt_image_1">

								<div class="image-input-wrapper m-2" {% if app.user.profile and app.user.profile.image %} style="background-image: url({{ asset(profile_pictures~'/'~app.user.profile.image) }})" {% else %} style="background-image: url({{ asset('defaultuser.png' ) }})" {% endif %}></div>
								<label class="btn btn-xs btn-icon btn-circle   btn-white btn-hover-text-primary btn-shadow" data-action="change" data-toggle="tooltip" title="" data-original-title="Change avatar">
									<i class="fa fa-pen icon-sm  text-muted" style="margin-left: 30px;"></i>
									{{ form_widget(profileform ) }}
								</label>
								<button class="btn btn-light-success my-8 btn-sm">
									{% trans %}Update profilepicture{% endtrans %}</button>
								{{ form_end(profileform) }}
							</div>
						</div>
					</div>
					<div class="flex-grow-1">
						<div class="d-flex align-items-center justify-content-between flex-wrap">
							<div class="mr-3">
								<div class="d-flex align-items-center mr-3">
									<a class="d-flex align-items-center text-dark text-hover-primary font-size-h5 font-weight-bold mr-3">{{ user}}</a>
									{# <span class="label label-light-success label-inline font-weight-bolder mr-1">Customer</span> #}
									<div class="dropdown dropdown-inline" data-toggle="tooltip" title="" data-placement="left" data-original-title="Quick actions"></div>
									<!--begin::Contacts-->
									<div class="d-flex flex-wrap my-2">
										<a class="text-muted text-hover-primary font-weight-bold mr-lg-8 mr-5 mb-lg-0 mb-2">
											<span
												class="svg-icon svg-icon-md svg-icon-gray-500 mr-1">
												<!--begin::Svg Icon | path:assets/media/svg/icons/Communication/Mail-notification.svg-->
												<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewbox="0 0 24 24" version="1.1">
													<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
														<rect x="0" y="0" width="24" height="24"></rect>
														<path d="M21,12.0829584 C20.6747915,12.0283988 20.3407122,12 20,12 C16.6862915,12 14,14.6862915 14,18 C14,18.3407122 14.0283988,18.6747915 14.0829584,19 L5,19 C3.8954305,19 3,18.1045695 3,17 L3,8 C3,6.8954305 3.8954305,6 5,6 L19,6 C20.1045695,6 21,6.8954305 21,8 L21,12.0829584 Z M18.1444251,7.83964668 L12,11.1481833 L5.85557487,7.83964668 C5.4908718,7.6432681 5.03602525,7.77972206 4.83964668,8.14442513 C4.6432681,8.5091282 4.77972206,8.96397475 5.14442513,9.16035332 L11.6444251,12.6603533 C11.8664074,12.7798822 12.1335926,12.7798822 12.3555749,12.6603533 L18.8555749,9.16035332 C19.2202779,8.96397475 19.3567319,8.5091282 19.1603533,8.14442513 C18.9639747,7.77972206 18.5091282,7.6432681 18.1444251,7.83964668 Z" fill="#000000"></path>
														<circle fill="#000000" opacity="0.3" cx="19.5" cy="17.5" r="2.5"></circle>
													</g>
												</svg>
												<!--end::Svg Icon-->
											</span>
											{{ user.user.email}}</a>

										<a class="text-muted text-hover-primary font-weight-bold">
											<span
												class="svg-icon svg-icon-md svg-icon-gray-500 mr-1">
												<!--begin::Svg Icon | path:assets/media/svg/icons/Map/Marker2.svg-->
												<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewbox="0 0 24 24" version="1.1">
													<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
														<rect x="0" y="0" width="24" height="24"></rect>
														<path d="M9.82829464,16.6565893 C7.02541569,15.7427556 5,13.1079084 5,10 C5,6.13400675 8.13400675,3 12,3 C15.8659932,3 19,6.13400675 19,10 C19,13.1079084 16.9745843,15.7427556 14.1717054,16.6565893 L12,21 L9.82829464,16.6565893 Z M12,12 C13.1045695,12 14,11.1045695 14,10 C14,8.8954305 13.1045695,8 12,8 C10.8954305,8 10,8.8954305 10,10 C10,11.1045695 10.8954305,12 12,12 Z" fill="#000000"></path>
													</g>
												</svg>
												<!--end::Svg Icon-->
											</span>
											{{user.dirctorate}}</a>
									</div>

								</div>
							</div>
						</div>
						<!--end::Info-->
						<div class="row m-4">
							<div class="col-4">
								{{user.phoneNumber}}

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-xl-12">


				<div class="card card-custom gutter-b shadow-lg p-3 mb-5 bg-body rounded ">
					<div class="card-header card-header-tabs-line">
						<div class="card-toolbar">
							<ul class="nav nav-tabs nav-tabs-space-lg nav-tabs-line nav-bold nav-tabs-line-3x" role="tablist">
								<li class="nav-item">
									<a class="nav-link" data-toggle="tab" href="#about">
										<span class="nav-icon mr-2">
											<span
												class="svg-icon mr-3">
												<!--begin::Svg Icon | path:assets/media/svg/icons/General/Notification2.svg-->
												<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewbox="0 0 24 24" version="1.1">
													<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
														<rect x="0" y="0" width="24" height="24"></rect>
														<path d="M13.2070325,4 C13.0721672,4.47683179 13,4.97998812 13,5.5 C13,8.53756612 15.4624339,11 18.5,11 C19.0200119,11 19.5231682,10.9278328 20,10.7929675 L20,17 C20,18.6568542 18.6568542,20 17,20 L7,20 C5.34314575,20 4,18.6568542 4,17 L4,7 C4,5.34314575 5.34314575,4 7,4 L13.2070325,4 Z" fill="#000000"></path>
														<circle fill="#000000" opacity="0.3" cx="18.5" cy="5.5" r="2.5"></circle>
													</g>
												</svg>
												<!--end::Svg Icon-->
											</span>
										</span>
										<span class="nav-text">About me</span>
									</a>
								</li>
								<li class="nav-item mr-3">
									<a class="nav-link active" data-toggle="tab" href="#personalDetails">
										<span class="nav-icon mr-2">
											<span
												class="svg-icon mr-3">
												<!--begin::Svg Icon | path:assets/media/svg/icons/Communication/Chat-check.svg-->
												<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewbox="0 0 24 24" version="1.1">
													<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
														<rect x="0" y="0" width="24" height="24"></rect>
														<path d="M4.875,20.75 C4.63541667,20.75 4.39583333,20.6541667 4.20416667,20.4625 L2.2875,18.5458333 C1.90416667,18.1625 1.90416667,17.5875 2.2875,17.2041667 C2.67083333,16.8208333 3.29375,16.8208333 3.62916667,17.2041667 L4.875,18.45 L8.0375,15.2875 C8.42083333,14.9041667 8.99583333,14.9041667 9.37916667,15.2875 C9.7625,15.6708333 9.7625,16.2458333 9.37916667,16.6291667 L5.54583333,20.4625 C5.35416667,20.6541667 5.11458333,20.75 4.875,20.75 Z" fill="#000000" fill-rule="nonzero" opacity="0.3"></path>
														<path d="M2,11.8650466 L2,6 C2,4.34314575 3.34314575,3 5,3 L19,3 C20.6568542,3 22,4.34314575 22,6 L22,15 C22,15.0032706 21.9999948,15.0065399 21.9999843,15.009808 L22.0249378,15 L22.0249378,19.5857864 C22.0249378,20.1380712 21.5772226,20.5857864 21.0249378,20.5857864 C20.7597213,20.5857864 20.5053674,20.4804296 20.317831,20.2928932 L18.0249378,18 L12.9835977,18 C12.7263047,14.0909841 9.47412135,11 5.5,11 C4.23590829,11 3.04485894,11.3127315 2,11.8650466 Z M6,7 C5.44771525,7 5,7.44771525 5,8 C5,8.55228475 5.44771525,9 6,9 L15,9 C15.5522847,9 16,8.55228475 16,8 C16,7.44771525 15.5522847,7 15,7 L6,7 Z" fill="#000000"></path>
													</g>
												</svg>
												<!--end::Svg Icon-->
											</span>
										</span>
										<span class="nav-text">Personal Details</span>
									</a>
								</li>
								<li class="nav-item mr-3">
									<a class="nav-link" data-toggle="tab" href="#projects">
										<span class="nav-icon mr-2">
											<span
												class="svg-icon mr-3">
												<!--begin::Svg Icon | path:assets/media/svg/icons/Devices/Display1.svg-->
												<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewbox="0 0 24 24" version="1.1">
													<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
														<rect x="0" y="0" width="24" height="24"></rect>
														<path d="M11,20 L11,17 C11,16.4477153 11.4477153,16 12,16 C12.5522847,16 13,16.4477153 13,17 L13,20 L15.5,20 C15.7761424,20 16,20.2238576 16,20.5 C16,20.7761424 15.7761424,21 15.5,21 L8.5,21 C8.22385763,21 8,20.7761424 8,20.5 C8,20.2238576 8.22385763,20 8.5,20 L11,20 Z" fill="#000000" opacity="0.3"></path>
														<path d="M3,5 L21,5 C21.5522847,5 22,5.44771525 22,6 L22,16 C22,16.5522847 21.5522847,17 21,17 L3,17 C2.44771525,17 2,16.5522847 2,16 L2,6 C2,5.44771525 2.44771525,5 3,5 Z M4.5,8 C4.22385763,8 4,8.22385763 4,8.5 C4,8.77614237 4.22385763,9 4.5,9 L13.5,9 C13.7761424,9 14,8.77614237 14,8.5 C14,8.22385763 13.7761424,8 13.5,8 L4.5,8 Z M4.5,10 C4.22385763,10 4,10.2238576 4,10.5 C4,10.7761424 4.22385763,11 4.5,11 L7.5,11 C7.77614237,11 8,10.7761424 8,10.5 C8,10.2238576 7.77614237,10 7.5,10 L4.5,10 Z" fill="#000000"></path>
													</g>
												</svg>
												<!--end::Svg Icon-->
											</span>
										</span>
										<span class="nav-text">CV and signatures</span>
									</a>
								</li>
								<li class="nav-item mr-3">
									<a class="nav-link " data-toggle="tab" href="#personalization">
										<span class="nav-icon mr-2">
											<span
												class="svg-icon mr-3">
												<!--begin::Svg Icon | path:assets/media/svg/icons/Home/Globe.svg-->
												<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewbox="0 0 24 24" version="1.1">
													<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
														<rect x="0" y="0" width="24" height="24"></rect>
														<path d="M13,18.9450712 L13,20 L14,20 C15.1045695,20 16,20.8954305 16,22 L8,22 C8,20.8954305 8.8954305,20 10,20 L11,20 L11,18.9448245 C9.02872877,18.7261967 7.20827378,17.866394 5.79372555,16.5182701 L4.73856106,17.6741866 C4.36621808,18.0820826 3.73370941,18.110904 3.32581341,17.7385611 C2.9179174,17.3662181 2.88909597,16.7337094 3.26143894,16.3258134 L5.04940685,14.367122 C5.46150313,13.9156769 6.17860937,13.9363085 6.56406875,14.4106998 C7.88623094,16.037907 9.86320756,17 12,17 C15.8659932,17 19,13.8659932 19,10 C19,7.73468744 17.9175842,5.65198725 16.1214335,4.34123851 C15.6753081,4.01567657 15.5775721,3.39010038 15.903134,2.94397499 C16.228696,2.49784959 16.8542722,2.4001136 17.3003976,2.72567554 C19.6071362,4.40902808 21,7.08906798 21,10 C21,14.6325537 17.4999505,18.4476269 13,18.9450712 Z" fill="#000000" fill-rule="nonzero"></path>
														<circle fill="#000000" opacity="0.3" cx="12" cy="10" r="6"></circle>
													</g>
												</svg>
												<!--end::Svg Icon-->
											</span>
										</span>
										<span class="nav-text">Personalization</span>
									</a>
								</li>
							</ul>
						</div>
					</div>
					<!--end::Header-->
					<!--begin::Body-->
					<div class="card-body  ">
						<div class="tab-content pt-5">
							<div class="tab-pane" id="about" role="tabpanel">
								<h4 class="my-2 mt-2 mb-4">Personal details</h4>
								<div class="row m-4 my-8">
									<div class="carsd   col-6 ">

										<table class="table my-4 p-2">
											<tbody>
												<tr>
													<th>Full name</th>
													<td>{{ user }}</td>
												</tr>

												<tr>
													<th>Gender:</th>
													<td>s</td>
												</tr>

												<tr>
													<th>Tel:</th>
													<td>{{user.phoneNumber}}</td>
												</tr>
												<tr>
													<th>Dirctorate:</th>
													<td>{{user.dirctorate}}</td>
												</tr>
												<tr>
													<th>Birth date:</th>
													<td>
														{{user.birthDate|date('M d, Y') }}
													{# {% set age = date().diff(date(user.birthDate)).y %} #}
														{# {{age}} #}
														{# {{ "now"|date("Y") }} #}
														{# {{date('y')}}	 #}
													</td>

												</tr>


											</tbody>
										</table>
									</div>

									<div class="cardd  col-6 ">


										<table class="table   my-4">
											<tbody>

												<tr>
													<th>Email</th>
													<td>{{ user.user.email }}</td>
												</tr>
												<tr>
													<th>Gender:</th>
													<td>s</td>
												</tr>
												<tr>
													<th>Email:
														<span class="text-muted">(alternative)</span>
													</th>
													<td>{{user.alternativeEmail}}</td>
												</tr>

												<tr>
													<th>Dirctorate:</th>
													<td>{{user.dirctorate}}</td>
												</tr>
												<tr>
													<th>Birth date:</th>
													<td>
														{{user.birthDate|date('M d, Y') }}
														{# {% set age = date().diff(date(user.birthDate)).y %}
																																																																																																																														{{age}} #}
													</td>

												</tr>

											</tbody>
										</table>
									</div>
								</div>


								<h4 class="my-2 mt-2 mb-4 th ">{% trans %}Work Experiences{% endtrans %}</h4>
								<table class="table my-8">
									<tr>
										<th>#</th>

										<th>{% trans %}Organization{% endtrans %}</th>
										<th>{% trans %}Position{% endtrans %}</th>
										<th>{% trans %}Start date{% endtrans %}</th>
										<th>{% trans %}End date{% endtrans %}</th>
									</tr>
									<tbody>


										{% for exp in user.workExperiences %}
											<tr>
												<td>{{loop.index}}</td>

												<td>{{exp.orgName}}</td>
												<td>{{exp.jobPosition}}</td>
												<td>{{ exp.dateStarted|date("M d, Y")}}</td>
												<td>{{ exp.dateLeft|date("M d, Y")}}</td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>
							<!--end::Tab Content-->
							<!--begin::Tab Content-->
							<div class="tab-pane active" id="personalDetails" role="tabpanel">
								{{ form_start(allform , {'attr': {'id': 'dupload-form', 'enctype': 'multipart/form-data'}}) }}

								<h4 class="my-2 mt-2 mb-4">
									{% trans %}Personal Info{% endtrans %}</h4>

								<div class="row">

									<div class="col-lg-6 col-xl-6 ">

										{{ form_label(allform.firstName ) }}
										{{ form_widget(allform.firstName ) }}

									</div>
									<div class="col-lg-6 col-xl-6 ">
										{{ form_label(allform.lastName ) }}

										{{ form_widget(allform.lastName ) }}

									</div>
								</div>
								<div class="row">

									<div class="col-lg-6 col-xl-6 ">

										{{ form_label(allform.alternativeEmail ) }}
										{{ form_widget(allform.alternativeEmail ) }}

									</div>
									<div class="col-lg-6 col-xl-6 ">
										{{ form_label(allform.phoneNumber ) }}

										{{ form_widget(allform.phoneNumber ) }}

									</div>
								</div>
								<div class="row">

									<div class="col-lg-6 col-xl-6 ">

										{{ form_label(allform.birthDate ) }}
										{{ form_widget(allform.birthDate ) }}

									</div>
									<div class="col-lg-6 col-xl-6 ">
										{{ form_label(allform.title ) }}

										{{ form_widget(allform.title ) }}

									</div>
								</div>


								<div
									class="row">

									{# <div class="col-lg-6 col-xl-6 ">
									
																			{{ form_label(allform.signature ) }}
																			{{ form_widget(allform.signature ) }}
									
																		</div> #}
									<div class="col-lg-6 col-xl-6 ">
										{{ form_label(allform.dirctorate ) }}

										{{ form_widget(allform.dirctorate ) }}

									</div>
								</div>

								<div class="row my-2">

									<div class="col-lg-12 col-xl-12 ">

										<h4 class="my-2 mt-2 mb-4">
											{% trans %}Work Experiences{% endtrans %}</h4>
										<button type="button" required="required" class="btn  add-another-collection-widget   btn-sm btn-light-primary float-center " data-list-selector="#objective-fields-list">
											<span aria-hidden="true">+</span>
											{% trans %}Add Work Experiences{% endtrans %}
										</button>

										<div class="form-group  row ">
											<ul id="objective-fields-list" class="p-4 m-2  form-group" data-prototype="{{_self.displayWorkExperiences(allform.workExperiences.vars.prototype)|e }}" data-widget-tags="{{ '<div class="row m-1"></div>'|e }}" data-widget-counter="{{ allform.workExperiences|length }}">
												{% for exp in allform.workExperiences %}
													<div class="m-1">
														{{ _self.displayWorkExperiences(exp) }}
													</div>
												{% endfor %}
											</ul>
										</div>
									</div>
								</div>
								<div class="progress">
									<div class="progress-bar progress-bar-striped progress-bar-animated bg-success" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
								</div>
								<button class="btn btn-success btn-sm my-4">{{ button_label|default('Save profile information')|trans }}</button>
								{{ form_end(allform) }}
							</div>
							<div class="tab-pane" id="projects" role="tabpanel">

								<div class="container p-4">
									<div class="cards">
										<form id="uploadForm" action="{{ path('profile_upload') }}" enctype="multipart/form-data">
											<div class="card   p-4">
												<div class="card-header border-0 pt-5">
													<h3 class="card-title font-weight-bolder">{% trans %}Upload Signature{% endtrans %}</h3>
												</div>
												<div class="row ">
													<div class="col-lg-4">
														<div class="pt-5">
															<img id="imagePreview" style="width:90%;" class=" normal d"/>
														</div>
													</div>
													<div class="col-lg-4">
														<div class="pt-5">
															<input type="file" name="file" id="uploadInput" class="form-control " required>

															<button type="submit" class="btn btn-success btn-shadow-hover mt-4 font-weight-bolder w-100 py-3">
																<i class="fa fa-upload"></i>
																{% trans %}Upload{% endtrans %}</button>
														</div>
													</div>
													<div class="col-lg-4">

														{% trans %}Old{% endtrans %}:<br>
														{% if app.user.profile  and app.user.profile.signature %}
															<img src="{{ asset(signatures~'/'~user.signature) }}" alt="profile-user" class="thumbnail card" style="width:230px;height: 230px;"/>
														{% else   %}
															{% trans %}No Signature uploaded{% endtrans %}

														{% endif %}
													</div>

												</div>

												<div class="progress">
													<div style="height: 25px;" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" id="uploadStatus" aria-valuenow="0" aria-valuemax="100"></div>
												</div>
											</div>
										</form>
									</div>
								</div>


							</div>


							<div class="tab-pane " id="personalization" role="tabpanel">
								<h4 class="my-2 mt-2 mb-4">
									Email preferences</h4>

								<table class="table col-6">
									<tbody>
										<tr>
											<th>New
											</th>
											<td>On</td>
										</tr>
										<tr>
											<th>News updates</th>
											<td>On</td>
										</tr>
										<tr>
											<th>New
											</th>
											<td>On</td>
										</tr>


									</tbody>
								</table>

							</div>
							<!--end::Tab Content-->
						</div>
					</div>
					<!--end::Body-->
				</div>
			</div>
		</div>
	</div>
{% endblock %}
{% block javascripts %}

	<script type='text/javascript'>
		jQuery(document).ready(function () {
$(document).on('click', '.remove-collection-widget', function (e) {
$(this).closest('.row').fadeOut().remove();
});
$(document).on('click', '.add-another-collection-widget', function (e) {
var list = jQuery(jQuery(this).attr('data-list-selector'));
var counter = list.data('widget-counter') || list.children().length;
var newWidget = list.attr('data-prototype');
newWidget = newWidget.replace(/__name__/g, counter);
counter++;
list.data('widget-counter', counter);
var newElem = jQuery(list.attr('data-widget-tags')).html(newWidget);
newElem.appendTo(list);
});
});
	</script>

	<script>
		document.getElementById('upload-form').onsubmit = function (event) {
event.preventDefault();
const formData = new FormData(this);
const xhr = new XMLHttpRequest();

xhr.upload.addEventListener('progress', function (e) {
if (e.lengthComputable) {
const percentComplete = (e.loaded / e.total) * 100;
const progressBar = document.getElementById('progress-bar');
const progress = document.getElementById('progress');

progress.style.display = 'block';
progressBar.style.width = percentComplete + '%';
progressBar.textContent = Math.round(percentComplete) + '%';
}
});

xhr.open('POST', this.action);
xhr.send(formData);
};
	</script>

	<script type='text/javascript'>

		const uploadForm = document.getElementById('uploadForm');
const progressBar = document.querySelector('.progress-bar');
const progressContainer = document.querySelector('.progress');
const uploadStatus = document.getElementById('uploadStatus');

uploadForm.addEventListener('submit', (event) => {
event.preventDefault();
const formData = new FormData(uploadForm);
const xhr = new XMLHttpRequest();

xhr.open('POST', '{{ path('profile_upload') }}', true);

xhr.upload.onprogress = function (event) {
updateProgress(event, xhr, progressBar, uploadStatus);
};

xhr.onloadstart = function () {
progressContainer.style.display = 'block';
progressBar.style.width = '0%';
progressBar.setAttribute('aria-valuenow', 0);
uploadStatus.textContent = 'Upload starting...';
};

xhr.onload = function () {
progressContainer.style.display = 'none';
handleResponse(xhr);
};

xhr.onerror = function () {
progressContainer.style.display = 'none';
displayFlashMessage('error', 'Upload failed due to a network error.');
};

xhr.onabort = function () {
progressContainer.style.display = 'none';
displayFlashMessage('error', 'Upload aborted.');
};

xhr.send(formData);
});

function handleResponse(xhr) {
try {
const response = xhr.responseText ? JSON.parse(xhr.responseText) : null;
if (response && response.message) {
displayFlashMessage('success', response.message);
uploadForm.reset();
} else {
displayFlashMessage('error', 'Upload successful, but unexpected response from server.');
}
} catch (error) {
displayFlashMessage('error', 'An unexpected error occurred.');
}
}

function displayFlashMessage(type, message) {
const flashMessage = document.createElement('div');
flashMessage.className = `flash-message ${type}`;
flashMessage.textContent = message;
document.body.appendChild(flashMessage);
setTimeout(() => {
document.body.removeChild(flashMessage);
}, 3000);
}

function updateProgress(event, xhr, progressBar, uploadStatus) {
if (event.lengthComputable) {
const percentComplete = (event.loaded / event.total) * 100;
progressBar.style.width = percentComplete + '%';
progressBar.setAttribute('aria-valuenow', percentComplete);
uploadStatus.textContent = `Uploading... ${
percentComplete.toFixed(0)
}%`;
} else {
uploadStatus.textContent = 'Uploading...';
}
}


let uploadInput = document.getElementById("uploadInput");

uploadInput.onchange = function () {
let image = new FileReader();

image.onload = function (e) {
document.getElementById("imagePreview").src = e.target.result;
};
image.readAsDataURL(this.files[0]);
};
	</script>
{% endblock %}
